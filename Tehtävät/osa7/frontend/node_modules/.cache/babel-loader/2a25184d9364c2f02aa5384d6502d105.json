{"ast":null,"code":"import _regeneratorRuntime from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehta\\u0308va\\u0308t/osa5/frontend/src/App.js\";\nimport React from 'react';\nimport Blog from './components/Blog';\nimport blogService from './services/blogs';\nimport loginService from './services/login';\nimport Notification from './components/Notification';\nimport BlogForm from './components/BlogForm';\nimport LoginForm from './components/LoginForm';\nimport Togglable from './components/Togglable';\n\nvar App =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(App, _React$Component);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n\n    _this.handleFieldChange = function (event) {\n      _this.setState(_defineProperty({}, event.target.name, event.target.value));\n    };\n\n    _this.login =\n    /*#__PURE__*/\n    function () {\n      var _ref = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(event) {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                event.preventDefault();\n                _context.prev = 1;\n                _context.next = 4;\n                return loginService.login({\n                  username: _this.state.username,\n                  password: _this.state.password\n                });\n\n              case 4:\n                user = _context.sent;\n                window.localStorage.setItem('loggedUser', JSON.stringify(user));\n                blogService.setToken(user.token);\n\n                _this.setState({\n                  username: '',\n                  password: '',\n                  user: user\n                });\n\n                _context.next = 14;\n                break;\n\n              case 10:\n                _context.prev = 10;\n                _context.t0 = _context[\"catch\"](1);\n\n                _this.setState({\n                  message: 'invalid username or password'\n                });\n\n                setTimeout(function () {\n                  _this.setState({\n                    message: null\n                  });\n                }, 5000);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[1, 10]]);\n      }));\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    _this.logout = function (event) {\n      event.preventDefault();\n      window.localStorage.removeItem('loggedUser');\n    };\n\n    _this.addBlog =\n    /*#__PURE__*/\n    function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var blogObject;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                event.preventDefault();\n\n                try {\n                  blogObject = {\n                    title: _this.state.title,\n                    author: _this.state.author,\n                    url: _this.state.url\n                  };\n                  blogService.create(blogObject);\n\n                  _this.setState({\n                    message: \"a new blog '\".concat(blogObject.title, \"' by \").concat(blogObject.author, \" added\")\n                  });\n\n                  setTimeout(function () {\n                    _this.setState({\n                      message: null\n                    });\n                  }, 5000);\n\n                  _this.setState({\n                    blogs: _this.state.blogs.concat(blogObject),\n                    title: '',\n                    author: '',\n                    url: ''\n                  });\n                } catch (ex) {\n                  console.log(ex);\n                }\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function (_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    _this.updateBlog =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(id) {\n        var x, updatedBlog;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                x = _this.state.blogs.find(function (b) {\n                  return b._id === id;\n                });\n\n                try {\n                  updatedBlog = {\n                    title: x.title,\n                    author: x.author,\n                    url: x.url,\n                    user: x.user,\n                    likes: x.likes + 1\n                  };\n                  blogService.update(id, updatedBlog);\n                } catch (ex) {\n                  console.log(ex);\n                }\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      return function (_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.state = {\n      blogs: [],\n      username: '',\n      password: '',\n      user: null,\n      title: '',\n      author: '',\n      url: '',\n      message: null\n    };\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      blogService.getAll().then(function (blogs) {\n        return _this2.setState({\n          blogs: blogs\n        });\n      });\n      var loggedUserJSON = window.localStorage.getItem('loggedUser');\n\n      if (loggedUserJSON) {\n        var user = JSON.parse(loggedUserJSON);\n        this.setState({\n          user: user\n        });\n        blogService.setToken(user.token);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var loginForm = function loginForm() {\n        return React.createElement(Togglable, {\n          buttonLabel: \"Login\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 116\n          },\n          __self: this\n        }, React.createElement(LoginForm, {\n          visible: _this3.state.visible,\n          username: _this3.state.username,\n          password: _this3.state.password,\n          handleChange: _this3.handleFieldChange,\n          handleSubmit: _this3.login,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 117\n          },\n          __self: this\n        }));\n      };\n\n      var blogForm = function blogForm() {\n        return React.createElement(Togglable, {\n          buttonLabel: \"Add\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 127\n          },\n          __self: this\n        }, React.createElement(BlogForm, {\n          visible: _this3.state.visible,\n          title: _this3.state.title,\n          author: _this3.state.author,\n          url: _this3.state.url,\n          handleChange: _this3.handleFieldChange,\n          handleSubmit: _this3.addBlog,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 128\n          },\n          __self: this\n        }));\n      };\n\n      this.state.blogs.sort(function (a, b) {\n        return b.likes - a.likes;\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, this.state.user === null ? React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }, \"Login\"), React.createElement(Notification, {\n        message: this.state.message,\n        className: \"error\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146\n        },\n        __self: this\n      }), loginForm()) : React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      }, React.createElement(\"h2\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 151\n        },\n        __self: this\n      }, \"Blogs\"), React.createElement(Notification, {\n        message: this.state.message,\n        className: \"confirm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 152\n        },\n        __self: this\n      }), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, this.state.user.name, \" logged in \", React.createElement(\"button\", {\n        onClick: this.logout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153\n        },\n        __self: this\n      }, \"Logout\")), blogForm(), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      }, this.state.blogs.map(function (blog) {\n        return React.createElement(Blog, {\n          key: blog._id,\n          blog: blog,\n          handleUpdate: function handleUpdate() {\n            return _this3.updateBlog(blog._id);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 158\n          },\n          __self: this\n        });\n      }))));\n    }\n  }]);\n\n  return App;\n}(React.Component);\n\nexport default App;","map":{"version":3,"sources":["/Users/Kullervo/Githubailua/Full_Stack-harjoitustyo/Tehtävät/osa5/frontend/src/App.js"],"names":["React","Blog","blogService","loginService","Notification","BlogForm","LoginForm","Togglable","App","props","handleFieldChange","event","setState","target","name","value","login","preventDefault","username","state","password","user","window","localStorage","setItem","JSON","stringify","setToken","token","message","setTimeout","logout","removeItem","addBlog","blogObject","title","author","url","create","blogs","concat","ex","console","log","updateBlog","id","x","find","b","_id","updatedBlog","likes","update","getAll","then","loggedUserJSON","getItem","parse","loginForm","visible","blogForm","sort","a","map","blog","Component"],"mappings":"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","sourcesContent":["import React from 'react'\nimport Blog from './components/Blog'\nimport blogService from './services/blogs'\nimport loginService from './services/login'\nimport Notification from './components/Notification'\nimport BlogForm from './components/BlogForm'\nimport LoginForm from './components/LoginForm'\nimport Togglable from './components/Togglable'\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      blogs: [],\n      username: '',\n      password: '',\n      user: null,\n      title: '',\n      author: '',\n      url: '',\n      message: null\n    }\n  }\n\n  componentDidMount() {\n    blogService.getAll().then(blogs =>\n      this.setState({ blogs })\n    )\n\n    const loggedUserJSON = window.localStorage.getItem('loggedUser')\n    if (loggedUserJSON) {\n      const user = JSON.parse(loggedUserJSON)\n      this.setState({ user })\n      blogService.setToken(user.token)\n    }\n\n  }\n\n  handleFieldChange = (event) => {\n    this.setState({ [event.target.name]: event.target.value })\n  }\n\n\n  login = async (event) => {\n    event.preventDefault()\n    try {\n      const user = await loginService.login({\n        username: this.state.username,\n        password: this.state.password\n      })\n\n      window.localStorage.setItem('loggedUser', JSON.stringify(user))\n      blogService.setToken(user.token)\n      this.setState({ username: '', password: '', user })\n    } catch (ex) {\n      this.setState({\n        message: 'invalid username or password'\n      })\n      setTimeout(() => {\n        this.setState({ message: null })\n      }, 5000)\n    }\n  }\n\n  logout = (event) => {\n    event.preventDefault()\n    window.localStorage.removeItem('loggedUser')\n  }\n\n  addBlog = async (event) => {\n    event.preventDefault()\n    try {\n      const blogObject = {\n        title: this.state.title,\n        author: this.state.author,\n        url: this.state.url\n      }\n\n      blogService.create(blogObject)\n      this.setState({ message: `a new blog '${blogObject.title}' by ${blogObject.author} added` })\n      setTimeout(() => {\n        this.setState({ message: null })\n      }, 5000)\n      this.setState({\n        blogs: this.state.blogs.concat(blogObject),\n        title: '',\n        author: '',\n        url: ''\n      })\n    } catch (ex) {\n      console.log(ex)\n    }\n  }\n\n  updateBlog = async (id) => {\n    const x = this.state.blogs.find(b => b._id === id)\n\n    try {\n      const updatedBlog = {\n        title: x.title,\n        author: x.author,\n        url: x.url,\n        user: x.user,\n        likes: x.likes + 1\n      }\n      blogService.update(id, updatedBlog)\n    } catch (ex) {\n      console.log(ex)\n    }\n  }\n\n\n  render() {\n\n    const loginForm = () => (\n      <Togglable buttonLabel=\"Login\">\n        <LoginForm\n          visible={this.state.visible}\n          username={this.state.username}\n          password={this.state.password}\n          handleChange={this.handleFieldChange}\n          handleSubmit={this.login} />\n      </Togglable>\n    )\n\n    const blogForm = () => (\n      <Togglable buttonLabel=\"Add\">\n        <BlogForm\n          visible={this.state.visible}\n          title={this.state.title}\n          author={this.state.author}\n          url={this.state.url}\n          handleChange={this.handleFieldChange}\n          handleSubmit={this.addBlog} />\n      </Togglable>\n    )\n    this.state.blogs.sort((a, b) => {\n      return b.likes - a.likes\n    })\n\n    return (\n      <div>\n        {this.state.user === null ?\n          <div>\n            <h2>Login</h2>\n            <Notification message={this.state.message} className=\"error\" />\n            {loginForm()}\n          </div>\n          :\n          <div>\n            <h2>Blogs</h2>\n            <Notification message={this.state.message} className=\"confirm\" />\n            <p>{this.state.user.name} logged in <button onClick={this.logout}>Logout</button></p>\n\n            {blogForm()}\n            <div>\n              {this.state.blogs.map(blog =>\n                <Blog key={blog._id} blog={blog} handleUpdate={() => this.updateBlog(blog._id)} />\n              )}</div>\n\n          </div>\n        }\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}